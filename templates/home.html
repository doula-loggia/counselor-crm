{% extends "base.html" %}

{% block title %}í™ˆ - ì‹¬ë¦¬ìƒë‹´ì‚¬ ë‚´ë‹´ì ê´€ë¦¬ ì‹œìŠ¤í…œ{% endblock %}

{% block content %}
<h2 style="margin-bottom: 2rem;">ëŒ€ì‹œë³´ë“œ</h2>

<div class="stats">
    <a href="/clients?status=counseling" class="stat-card" style="text-decoration: none; color: inherit;">
        <h3>ìƒë‹´ì¤‘ ë‚´ë‹´ì</h3>
        <div class="number">{{ counseling_clients }}</div>
        <div class="subtext">ì¬ìƒë‹´ {{ reengaged_clients }}</div>
    </a>
    <a href="/examinees?source=existing_client" class="stat-card" style="text-decoration: none; color: inherit;">
        <h3>ì—°ê³„ëœ ìˆ˜ê²€ì</h3>
        <div class="number">{{ linked_examinees }}</div>
    </a>
    <a href="/sessions" class="stat-card" style="text-decoration: none; color: inherit;">
        <h3>ì „ì²´ íšŒê¸°</h3>
        <div class="number">{{ total_sessions }}</div>
    </a>
    <a href="/clients" class="stat-card" style="text-decoration: none; color: inherit;">
        <h3>ì „ì²´ ë‚´ë‹´ì</h3>
        <div class="number">{{ total_clients }}</div>
    </a>
    <a href="/examinees" class="stat-card" style="text-decoration: none; color: inherit;">
        <h3>ì „ì²´ ìˆ˜ê²€ì</h3>
        <div class="number">{{ total_examinees }}</div>
    </a>
    <a href="/calendar" class="stat-card" style="text-decoration: none; color: inherit; display: flex; flex-direction: column; gap: 0.6rem; align-items: center;">
        <h3 style="margin-bottom: 0;">ì¼ì • ìº˜ë¦°ë”</h3>
        <div style="display: flex; align-items: center; gap: 0.6rem; color: #2563eb; font-weight: 700;">
            <span style="font-size: 2.2rem;">ğŸ“…</span>
            <div style="text-align: left;">
                <div style="font-size: 1.1rem; color: #1f2937;">{{ today_label }}</div>
                <div style="font-size: 0.9rem; color: #6b7280;">{{ weekday_labels[today_weekday_idx] }}ìš”ì¼</div>
            </div>
        </div>
        <div style="width: 100%; background: #eff6ff; border-radius: 8px; padding: 0.7rem;">
            <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.3rem; font-size: 0.75rem; text-align: center;">
                {% for label in weekday_labels %}
                    <span style="padding: 0.35rem 0; border-radius: 999px; font-weight: 600; background: {% if loop.index0 == today_weekday_idx %}#3b82f6{% else %}transparent{% endif %}; color: {% if loop.index0 == today_weekday_idx %}#ffffff{% else %}#1f2937{% endif %};">{{ label }}</span>
                {% endfor %}
            </div>
            <div style="margin-top: 0.6rem; font-size: 0.78rem; color: #2563eb; text-align: center;">ìº˜ë¦°ë”ì—ì„œ ëª¨ë“  ì¼ì • í™•ì¸í•˜ê¸° â†’</div>
        </div>
    </a>
</div>

<div class="card">
    <h3 style="margin-bottom: 1rem;">ë¹ ë¥¸ ë©”ë‰´</h3>
    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
        <a href="/clients/new" class="btn">ìƒˆ ë‚´ë‹´ì ì¶”ê°€</a>
        <a href="/sessions/new" class="btn">ìƒˆ íšŒê¸° ì¶”ê°€</a>
        <a href="/examinees/new" class="btn">ìƒˆ ìˆ˜ê²€ì ë“±ë¡</a>
        <a href="/clients" class="btn btn-secondary">ë‚´ë‹´ì ëª©ë¡</a>
        <a href="/sessions" class="btn btn-secondary">íšŒê¸° ëª©ë¡</a>
        <a href="/examinees" class="btn btn-secondary">ìˆ˜ê²€ì ëª©ë¡</a>
    </div>
    {% if upcoming_sessions %}
    <hr style="border: none; border-top: 1px solid #e5e7eb; margin: 1.5rem 0;">
    <div>
        <h4 style="margin-bottom: 0.6rem; color: #1f2937; font-size: 1.05rem;">ë‹¤ê°€ì˜¤ëŠ” íšŒê¸°</h4>
        <ul style="list-style: none; padding: 0; margin: 0; display: grid; gap: 0.6rem;">
            {% for session in upcoming_sessions %}
            <li style="display: flex; justify-content: space-between; align-items: center; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; padding: 0.75rem 1rem;">
                <div>
                    <div style="font-weight: 600; color: #1f2937;">{{ session.date_label }} Â· {{ session.participants }}</div>
                    {% if session.mode %}
                    <div style="color: #6b7280; font-size: 0.85rem; margin-top: 0.2rem;">ë°©ì‹: {{ session.mode }}</div>
                    {% endif %}
                </div>
                <a href="{{ session.url }}" class="btn btn-secondary" style="white-space: nowrap;">ìƒì„¸ ë³´ê¸°</a>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
</div>

{% if missing_consents %}
<div class="card" style="border-left: 4px solid #e74c3c; background: #fef2f2; margin-top: 1.5rem;">
    <h3 style="color: #c0392b; margin-bottom: 0.8rem;">í•„ìˆ˜ ë™ì˜ì„œ ë¯¸ì™„ë£Œ ë‚´ë‹´ì ({{ missing_consents_count }}ëª…)</h3>
    <p style="color: #7f1d1d; font-size: 0.95rem; margin-bottom: 1rem;">ì•„ë˜ ë‚´ë‹´ìëŠ” ìƒë‹´ ë™ì˜ì„œÂ·ë¹„ë°€ë³´ì¥ ì•ˆë‚´ì„œÂ·ê°œì¸ì •ë³´ ë™ì˜ì„œ ì¤‘ í•˜ë‚˜ ì´ìƒì´ ëˆ„ë½ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
    <ul style="list-style: none; padding: 0; margin: 0; display: grid; gap: 0.6rem;">
        {% for consent in missing_consents[:5] %}
        <li style="background: white; padding: 0.75rem 1rem; border-radius: 8px; border: 1px solid #fee2e2; display: flex; justify-content: space-between; align-items: center;">
            <div>
                <strong>{{ consent.client_name }}</strong>
                <span style="color: #b91c1c; font-size: 0.9rem; margin-left: 0.6rem;">{{ consent.missing_labels | join(', ') }}</span>
            </div>
            <a href="/clients/{{ consent.client_id }}" class="btn btn-secondary" style="background: #e74c3c; border: none;">ë™ì˜ì„œ ë“±ë¡</a>
        </li>
        {% endfor %}
    </ul>
    {% if missing_consents_count > 5 %}
        <p style="color: #7f1d1d; font-size: 0.9rem; margin-top: 0.8rem;">ì™¸ {{ missing_consents_count - 5 }}ëª… ë” ìˆìŒ.</p>
    {% endif %}
</div>
{% endif %}
{% endblock %}
