{% extends "base.html" %}

{% block title %}내담자 목록 - 심리상담사 내담자 관리 시스템{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <h2>내담자 목록</h2>
    <div style="display: flex; gap: 0.5rem;">
        <a href="/export/clients" class="btn btn-secondary">CSV 다운로드</a>
        <a href="/clients/new" class="btn">새 내담자 추가</a>
    </div>
</div>

<div class="card">
    <div style="margin-bottom: 1rem; display: flex; gap: 0.5rem; align-items: center;">
        <span style="font-weight: bold; color: #34495e;">상태:</span>
        <a href="/clients" class="btn {% if not status_filter %}btn-secondary{% else %}btn{% endif %}" style="padding: 0.5rem 1rem; font-size: 0.9rem;">전체</a>
        <a href="/clients?status=active" class="btn {% if status_filter == 'active' %}btn-secondary{% else %}btn{% endif %}" style="padding: 0.5rem 1rem; font-size: 0.9rem;">활성</a>
        <a href="/clients?status=inactive" class="btn {% if status_filter == 'inactive' %}btn-secondary{% else %}btn{% endif %}" style="padding: 0.5rem 1rem; font-size: 0.9rem;">비활성</a>
    </div>
    
    <form method="GET" class="search-box">
        <input type="text" name="search" placeholder="이름 또는 태그로 검색..." value="{{ search_query }}">
        {% if status_filter %}
            <input type="hidden" name="status" value="{{ status_filter }}">
        {% endif %}
        <button type="submit">검색</button>
        {% if search_query %}
            <a href="/clients{% if status_filter %}?status={{ status_filter }}{% endif %}" class="btn btn-secondary">검색 초기화</a>
        {% endif %}
    </form>
    
    {% if clients %}
    <table>
        <thead>
            <tr>
                <th>이름</th>
                <th>전화번호</th>
                <th>이메일</th>
                <th>첫 회기 날짜</th>
                <th>상태</th>
                <th>태그</th>
                <th>관리</th>
            </tr>
        </thead>
        <tbody>
            {% for client in clients %}
            <tr>
                <td><a href="/clients/{{ client.client_id }}" style="color: #2c3e50; text-decoration: none;"><strong>{{ client.name }}</strong></a></td>
                <td>{{ client.phone }}</td>
                <td>{{ client.email }}</td>
                <td>{{ client.first_session_date }}</td>
                <td>
                    {% if client.status == 'active' %}
                        <span style="color: #27ae60; font-weight: bold;">활성</span>
                    {% else %}
                        <span style="color: #95a5a6;">비활성</span>
                    {% endif %}
                </td>
                <td>
                    {% if client.tags %}
                        {% set tag_list = client.tags.split(',') %}
                        {% for tag in tag_list %}
                            <a href="/clients?search={{ tag.strip() }}" style="background: #ecf0f1; padding: 0.2rem 0.5rem; border-radius: 3px; text-decoration: none; color: #2c3e50; font-size: 0.9rem; display: inline-block; margin: 0.1rem;">{{ tag.strip() }}</a>{% if not loop.last %} {% endif %}
                        {% endfor %}
                    {% endif %}
                </td>
                <td>
                    <a href="/clients/{{ client.client_id }}/edit" style="color: #27ae60; text-decoration: none;">수정</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="text-align: center; color: #7f8c8d; padding: 2rem;">
        {% if search_query %}
            검색 결과가 없습니다.
        {% else %}
            등록된 내담자가 없습니다.
        {% endif %}
    </p>
    {% endif %}
</div>
{% endblock %}
