{% extends "base.html" %}

{% block title %}{{ examinee.name }} - ìˆ˜ê²€ì ìƒì„¸{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 0.5rem;">
    <h2 style="margin: 0;">ìˆ˜ê²€ì ìƒì„¸ - {{ examinee.name }}</h2>
    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
        <a href="/examinees/{{ examinee.examinee_id }}/edit" class="btn">ì •ë³´ ìˆ˜ì •</a>
        <form method="POST" action="/examinees/{{ examinee.examinee_id }}/delete" onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ìˆ˜ê²€ì ê¸°ë¡ì´ ì˜êµ¬ ì‚­ì œë©ë‹ˆë‹¤.');" style="margin: 0;">
            <button type="submit" class="btn" style="background-color: #e74c3c;">ì‚­ì œ</button>
        </form>
        <a href="/examinees" class="btn btn-secondary">ëª©ë¡ìœ¼ë¡œ</a>
    </div>
</div>

<div class="card" style="margin-bottom: 1.5rem;">
    <h3>ê¸°ë³¸ ì •ë³´</h3>
    <table style="margin: 0;">
        <tr>
            <th style="width: 20%;">ìˆ˜ê²€ì ì´ë¦„</th>
            <td><strong>{{ examinee.name }}</strong></td>
        </tr>
        <tr>
            <th>í˜„ì¬ ìƒíƒœ</th>
            <td>{{ status_labels.get(examinee.status, examinee.status or '-')}} </td>
        </tr>
        <tr>
            <th>ì¶œì²˜</th>
            <td>{{ source_labels.get(examinee.source, examinee.source or '-') }}</td>
        </tr>
        <tr>
            <th>ì—°ê²°ëœ ë‚´ë‹´ì</th>
            <td>
                {% if linked_client %}
                    <a href="/clients/{{ linked_client.client_id }}" style="color: #3b5998; text-decoration: none;">
                        {{ linked_client.name }} ({{ linked_client.client_id }})
                    </a>
                {% elif examinee.linked_client_id %}
                    {{ examinee.linked_client_id }}
                {% else %}
                    <span style="color: #95a5a6;">ì—°ê²°ë˜ì§€ ì•ŠìŒ</span>
                {% endif %}
            </td>
        </tr>
        <tr>
            <th>ì—°ë½ì²˜</th>
            <td>{{ examinee.phone or '-' }}</td>
        </tr>
        <tr>
            <th>ì´ë©”ì¼</th>
            <td>{{ examinee.email or '-' }}</td>
        </tr>
        <tr>
            <th>ì¶œìƒì—°ë„</th>
            <td>{{ examinee.birth_year or '-' }}</td>
        </tr>
        <tr>
            <th>ì„±ë³„</th>
            <td>{{ examinee.gender or '-' }}</td>
        </tr>
    </table>
</div>

<div class="card" style="margin-bottom: 1.5rem;">
    <h3>ê²€ì‚¬ ì •ë³´</h3>
    <table style="margin: 0;">
        <tr>
            <th style="width: 20%;">ê²€ì‚¬ì¼</th>
            <td>{{ examinee.assessment_date or '-' }}</td>
        </tr>
        <tr>
            <th>ê²€ì‚¬ ì¢…ë¥˜</th>
            <td>{{ examinee.assessment_type or '-' }}</td>
        </tr>
        <tr>
            <th>ê²€ì‚¬ ë„êµ¬</th>
            <td>{{ examinee.assessment_tool or '-' }}</td>
        </tr>
        <tr>
            <th>ê²€ì‚¬ ìš”ì•½</th>
            <td style="white-space: pre-wrap;">{{ examinee.assessment_description or '-' }}</td>
        </tr>
        <tr>
            <th>ë³´ê³ ì„œ íŒŒì¼</th>
            <td>
                {% if examinee.report_file %}
                    <a href="/download/examinee_report/{{ examinee.examinee_id }}" style="color: #3b5998; text-decoration: none;">
                        ğŸ“„ {{ examinee.report_file }} (ë‹¤ìš´ë¡œë“œ)
                    </a>
                {% else %}
                    <span style="color: #95a5a6;">ë“±ë¡ëœ íŒŒì¼ ì—†ìŒ</span>
                {% endif %}
            </td>
        </tr>
        <tr>
            <th>ìƒë‹´ì ë©”ëª¨</th>
            <td style="white-space: pre-wrap;">{{ examinee.notes or '-' }}</td>
        </tr>
    </table>
</div>

{% if not examinee.linked_client_id %}
<div class="card" style="margin-bottom: 1.5rem;">
    <h3>ë‚´ë‹´ì ì—°ê²°</h3>
    <div style="display: flex; flex-wrap: wrap; gap: 1.5rem;">
        <div style="flex: 1 1 260px;">
            <form method="POST" action="/examinees/{{ examinee.examinee_id }}/link-client">
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label for="client_id">ê¸°ì¡´ ë‚´ë‹´ì ì„ íƒ</label>
                    <select id="client_id" name="client_id" required>
                        <option value="">ë‚´ë‹´ìë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                        {% for client in clients %}
                            <option value="{{ client.client_id }}">{{ client.name }} ({{ client.client_id }})</option>
                        {% endfor %}
                    </select>
                </div>
                <button type="submit">ì„ íƒí•œ ë‚´ë‹´ìì™€ ì—°ê²°</button>
            </form>
        </div>
        <div style="flex: 1 1 260px;">
            <form method="POST" action="/examinees/{{ examinee.examinee_id }}/create-client">
                <p style="margin-bottom: 1rem; color: #4b5563;">ë‚´ë‹´ì ì •ë³´ê°€ ì—†ëŠ” ê²½ìš°, ìˆ˜ê²€ì ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìƒˆ ë‚´ë‹´ìë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                <button type="submit" class="btn btn-secondary">ìƒˆ ë‚´ë‹´ì ìƒì„± ë° ì—°ê²°</button>
            </form>
        </div>
    </div>
</div>
{% endif %}

<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h3>ê´€ë ¨ ìƒë‹´ íšŒê¸°</h3>
        {% if linked_client %}
            <a href="/sessions/new?client_id={{ linked_client.client_id }}" class="btn btn-secondary">ìƒˆ íšŒê¸° ì¶”ê°€</a>
        {% endif %}
    </div>
    
    {% if associated_sessions %}
    <table>
        <thead>
            <tr>
                <th>ë‚ ì§œ</th>
                <th>ëª¨ë“œ</th>
                <th>ëª©í‘œ</th>
                <th>ê´€ë¦¬</th>
            </tr>
        </thead>
        <tbody>
            {% for session in associated_sessions %}
            <tr>
                <td><a href="/sessions/{{ session.session_id }}" style="color: #3b5998; text-decoration: none;">{{ session.date }}</a></td>
                <td>{{ session.mode or '-' }}</td>
                <td>{{ session.goals[:50] if session.goals else '-' }}{% if session.goals and session.goals|length > 50 %}...{% endif %}</td>
                <td><a href="/sessions/{{ session.session_id }}" style="color: #27ae60; text-decoration: none;">ë³´ê¸°</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="text-align: center; color: #7f8c8d; padding: 1.5rem;">ì—°ê´€ëœ ìƒë‹´ íšŒê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endif %}
</div>
{% endblock %}
