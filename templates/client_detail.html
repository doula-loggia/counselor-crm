{% extends "base.html" %}

{% block title %}{{ client.name }} - ë‚´ë‹´ì ìƒì„¸{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <h2>{{ client.name }} ë‹˜</h2>
    <div style="display: flex; gap: 0.5rem;">
        <a href="/clients/{{ client.client_id }}/edit" class="btn">ì •ë³´ ìˆ˜ì •</a>
        <a href="/clients" class="btn btn-secondary">ëª©ë¡ìœ¼ë¡œ</a>
    </div>
</div>

<div class="card" style="margin-bottom: 1.5rem;">
    <h3 style="margin-bottom: 1rem;">ê¸°ë³¸ ì •ë³´</h3>
    <table style="margin: 0;">
        <tr>
            <th style="width: 20%;">ì´ë¦„</th>
            <td><strong>{{ client.name }}</strong></td>
        </tr>
        <tr>
            <th>ì „í™”ë²ˆí˜¸</th>
            <td>{{ client.phone }}</td>
        </tr>
        <tr>
            <th>ì´ë©”ì¼</th>
            <td>{{ client.email }}</td>
        </tr>
        <tr>
            <th>ì¶œìƒì—°ë„</th>
            <td>
                {% if client.birth_year %}
                    {{ client.birth_year | int }}
                    <span id="age_display" style="color: #7f8c8d; margin-left: 0.5rem;"></span>
                {% endif %}
            </td>
        </tr>
        <tr>
            <th>ì„±ë³„</th>
            <td>{{ client.gender }}</td>
        </tr>
        <tr>
            <th>ì²« íšŒê¸° ë‚ ì§œ</th>
            <td>{{ client.first_session_date }}</td>
        </tr>
        <tr>
            <th>ìƒíƒœ</th>
            <td>
                {% if client.status == 'active' %}
                    <span style="color: #27ae60; font-weight: bold;">í™œì„±</span>
                {% else %}
                    <span style="color: #95a5a6;">ë¹„í™œì„±</span>
                {% endif %}
            </td>
        </tr>
        <tr>
            <th>íƒœê·¸</th>
            <td>{{ client.tags }}</td>
        </tr>
        {% if client.medical_history %}
        <tr>
            <th>ê³¼ê±°ë³‘ë ¥</th>
            <td style="white-space: pre-wrap;">{{ client.medical_history }}</td>
        </tr>
        {% endif %}
        {% if client.counseling_history %}
        <tr>
            <th>ìƒë‹´ì´ë ¥</th>
            <td style="white-space: pre-wrap;">{{ client.counseling_history }}</td>
        </tr>
        {% endif %}
        {% if client.psychological_test_file %}
        <tr>
            <th>ì‹¬ë¦¬ê²€ì‚¬ íŒŒì¼</th>
            <td>
                <a href="/download/psychological_test/{{ client.client_id }}" style="color: #3498db; text-decoration: none;">
                    ğŸ“„ {{ client.psychological_test_file }} (ë‹¤ìš´ë¡œë“œ)
                </a>
            </td>
        </tr>
        {% endif %}
        {% if client.notes %}
        <tr>
            <th>ë©”ëª¨</th>
            <td style="white-space: pre-wrap;">{{ client.notes }}</td>
        </tr>
        {% endif %}
    </table>
</div>

<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h3>íšŒê¸° ê¸°ë¡ ({{ sessions|length }}íšŒ)</h3>
        <a href="/sessions/new" class="btn">ìƒˆ íšŒê¸° ì¶”ê°€</a>
    </div>
    
    {% if sessions %}
    <table>
        <thead>
            <tr>
                <th>ë‚ ì§œ</th>
                <th>ì‹œê°„</th>
                <th>ëª¨ë“œ</th>
                <th>ëª©í‘œ</th>
                <th>ë¹„ìš©</th>
                <th>ë‚©ë¶€</th>
                <th>ê²°ì œìˆ˜ë‹¨</th>
                <th>í‰ê°€</th>
                <th>ê´€ë¦¬</th>
            </tr>
        </thead>
        <tbody>
            {% for session in sessions %}
            <tr>
                <td>
                    <a href="/sessions/{{ session.session_id }}" style="color: #3b5998; text-decoration: none; font-weight: 600; display: block; transition: color 0.2s;" 
                       onmouseover="this.style.color='#2d4373'" 
                       onmouseout="this.style.color='#3b5998'">
                        {{ session.date }}
                    </a>
                </td>
                <td>{{ session.duration_minutes }}ë¶„</td>
                <td>{{ session.mode }}</td>
                <td>{{ session.goals[:50] }}{% if session.goals|length > 50 %}...{% endif %}</td>
                <td>{% if session.fee %}{{ (session.fee | float / 10000) | int }}ë§Œì›{% endif %}</td>
                <td>
                    {% if session.paid == 'Y' %}
                        <span style="color: #27ae60;">âœ“</span>
                    {% else %}
                        <span style="color: #e74c3c;">âœ—</span>
                    {% endif %}
                </td>
                <td>{{ session.payment_method }}</td>
                <td>
                    {% if session.rating %}
                        {{ session.rating }}/5
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    <a href="/sessions/{{ session.session_id }}/edit" style="color: #27ae60; text-decoration: none; font-weight: 500;">ìˆ˜ì •</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="text-align: center; color: #7f8c8d; padding: 2rem;">
        ì•„ì§ ë“±ë¡ëœ íšŒê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.
    </p>
    {% endif %}
</div>

<script>
const birthYear = {{ client.birth_year | int if client.birth_year else 0 }};
const ageDisplay = document.getElementById('age_display');

if (birthYear > 0) {
    const currentYear = new Date().getFullYear();
    const age = currentYear - birthYear;
    ageDisplay.textContent = `(ë§Œ ${age}ì„¸)`;
}
</script>

{% endblock %}
