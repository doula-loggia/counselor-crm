{% extends "base.html" %}

{% block title %}íšŒê¸° ìƒì„¸ - ì¹˜ë£Œì‚¬ í´ë¼ì´ì–¸íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <h2>íšŒê¸° ìƒì„¸</h2>
    <a href="/sessions" class="btn btn-secondary">ëª©ë¡ìœ¼ë¡œ</a>
</div>

<div class="card" style="margin-bottom: 1.5rem;">
    <h3 style="margin-bottom: 1rem;">ê¸°ë³¸ ì •ë³´</h3>
    <table style="margin: 0;">
        <tr>
            <th style="width: 20%;">ë‚´ë‹´ì</th>
            <td><strong>{{ session.name }}</strong></td>
        </tr>
        <tr>
            <th>ë‚ ì§œ</th>
            <td>{{ session.date }}</td>
        </tr>
        <tr>
            <th>ì‹œê°„</th>
            <td>{{ session.duration_minutes }}ë¶„</td>
        </tr>
        <tr>
            <th>ëª¨ë“œ</th>
            <td>{{ session.mode }}</td>
        </tr>
        <tr>
            <th>ëª©í‘œ</th>
            <td>{{ session.goals }}</td>
        </tr>
        <tr>
            <th>ì¤‘ì¬/ê°œì…</th>
            <td>{{ session.interventions }}</td>
        </tr>
        <tr>
            <th>íšŒê¸° ë…¸íŠ¸</th>
            <td>{{ session.notes }}</td>
        </tr>
        <tr>
            <th>ë¹„ìš©</th>
            <td>{{ session.fee }}ì› ({% if session.paid == 'Y' %}<span style="color: #27ae60;">ì™„ë‚©</span>{% else %}<span style="color: #e74c3c;">ë¯¸ë‚©</span>{% endif %})</td>
        </tr>
    </table>
</div>

<div class="card" style="margin-bottom: 1.5rem;">
    <h3 style="margin-bottom: 1rem;">ì¶•ì–´ë¡ ì—…ë¡œë“œ</h3>
    <form method="POST" action="/sessions/{{ session.session_id }}/upload-transcript" enctype="multipart/form-data">
        <div class="form-group">
            <label for="transcript_file">íŒŒì¼ ì—…ë¡œë“œ (TXT, í…ìŠ¤íŠ¸ íŒŒì¼)</label>
            <input type="file" id="transcript_file" name="transcript_file" accept=".txt">
        </div>
        
        <p style="text-align: center; color: #7f8c8d; margin: 1rem 0;">ë˜ëŠ”</p>
        
        <div class="form-group">
            <label for="transcript_text">ì§ì ‘ ì…ë ¥</label>
            <textarea id="transcript_text" name="transcript_text" rows="8" placeholder="ì¶•ì–´ë¡ ë‚´ìš©ì„ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”...">{{ session.transcript }}</textarea>
        </div>
        
        <button type="submit">ì—…ë¡œë“œ ë° AI ë¶„ì„</button>
        <p style="margin-top: 0.5rem; color: #7f8c8d; font-size: 0.9rem;">
            * OpenAI API í‚¤ê°€ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ AI ë¶„ì„ì´ ì§„í–‰ë©ë‹ˆë‹¤.
        </p>
    </form>
</div>

{% if session.analysis_summary %}
<div class="card" style="background: #f8f9fa; border-left: 4px solid #3498db;">
    <h3 style="margin-bottom: 1.5rem; color: #2c3e50;">ğŸ¤– AI ë¶„ì„ ê²°ê³¼</h3>
    
    <div style="margin-bottom: 1.5rem;">
        <h4 style="color: #34495e; margin-bottom: 0.5rem;">ğŸ“ ì „ì²´ ì´ì•¼ê¸° ìš”ì•½</h4>
        <p style="background: white; padding: 1rem; border-radius: 4px;">{{ session.analysis_summary }}</p>
    </div>
    
    <div style="margin-bottom: 1.5rem;">
        <h4 style="color: #34495e; margin-bottom: 0.5rem;">âš¡ ì£¼ìš” ìŠ¤íŠ¸ë ˆìŠ¤ ìš”ì¸</h4>
        <p style="background: white; padding: 1rem; border-radius: 4px; white-space: pre-wrap;">{{ session.analysis_stress }}</p>
    </div>
    
    <div style="margin-bottom: 1.5rem;">
        <h4 style="color: #34495e; margin-bottom: 0.5rem;">ğŸ’¬ ìƒë‹´ì ê°œì… í‰ê°€</h4>
        <p style="background: white; padding: 1rem; border-radius: 4px; white-space: pre-wrap;">{{ session.analysis_intervention }}</p>
    </div>
    
    <div style="margin-bottom: 1.5rem;">
        <h4 style="color: #34495e; margin-bottom: 0.5rem;">ğŸ’¡ ë” ë‚˜ì€ ê°œì… ëŒ€ì•ˆ</h4>
        <p style="background: white; padding: 1rem; border-radius: 4px; white-space: pre-wrap;">{{ session.analysis_alternatives }}</p>
    </div>
    
    <div style="margin-bottom: 1.5rem;">
        <h4 style="color: #34495e; margin-bottom: 0.5rem;">ğŸ“‹ ì´í›„ ìƒë‹´ ê³„íš</h4>
        <p style="background: white; padding: 1rem; border-radius: 4px; white-space: pre-wrap;">{{ session.analysis_plan }}</p>
    </div>
    
    <div style="margin-bottom: 1.5rem;">
        <h4 style="color: #34495e; margin-bottom: 0.5rem;">â¤ï¸ ì£¼ìš” ê°ì •</h4>
        <p style="background: white; padding: 1rem; border-radius: 4px; white-space: pre-wrap;">{{ session.analysis_emotions }}</p>
    </div>
    
    {% if session.analysis_distortions %}
    <div style="margin-bottom: 1.5rem;">
        <h4 style="color: #34495e; margin-bottom: 0.5rem;">ğŸ” ì¸ì§€ì™œê³¡ ë° ë‹¹ìœ„ì  ì‚¬ê³ </h4>
        <p style="background: white; padding: 1rem; border-radius: 4px; white-space: pre-wrap;">{{ session.analysis_distortions }}</p>
    </div>
    {% endif %}
    
    {% if session.analysis_resistance %}
    <div style="margin-bottom: 1.5rem;">
        <h4 style="color: #34495e; margin-bottom: 0.5rem;">ğŸ›¡ï¸ ì €í•­ íŒ¨í„´</h4>
        <p style="background: white; padding: 1rem; border-radius: 4px; white-space: pre-wrap;">{{ session.analysis_resistance }}</p>
    </div>
    {% endif %}
</div>
{% else %}
<div class="card" style="background: #fff3cd; border-left: 4px solid #ffc107;">
    <p style="margin: 0; color: #856404;">
        â„¹ï¸ ì¶•ì–´ë¡ì„ ì—…ë¡œë“œí•˜ë©´ AI ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
    </p>
</div>
{% endif %}

{% endblock %}
